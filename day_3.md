# План третьего занятия

На этом занятии, наконец-то будет работа с таблицами!
Мне кажется, логичным показать как работать с таблицами на небольшом примере, чтобы ребята всегда могли себя проверить, 
т.е. сравнить полученный результат с ожидаемым. Затем можно перейти к реальным данным и на их основе построить графики, а именно TAS диаграмму.

Для занятия я подготовил два ноутбука:
* [day_3_pandas_dataframe](https://github.com/rzaitov/earth_spbu/blob/main/day_3_pandas_dataframe.ipynb)
* [day_3_data_frame_manipulation](https://github.com/rzaitov/earth_spbu/blob/main/day_3_data_frame_manipulation.ipynb)

## DataFrame
В первом ноутбуке мы создаем небольшую табличку из шести строк и трех столбцов и смотрим какие методы доступны для работы с таблицами.

Нужно показать, что DataFrame – это двумерная структура данных, в отличие от всех ранее рассмотренных: 
список (list), словарь (dictionary) и последовательность (Series).

DataFrame имеет сходство как со списоком, так и со словарем. 
Сходство со списком заключается в том, что DataFrame позволяет запрашивать данные как по числовому индексу через `.iloc` т.е. `index location`. 
С другой стороны DataFrame похож на словать, т.к. позволяет запрашивать данные по строковому индексу через `.loc` т.е. `index label`.

В ноутбуке разбираются несколько способов фильтрации данных, т.е. способов "отбросить/скрыть" столбцы и строки, которые нас не инересуют. 
Например, как можно запросить только нужные столбцы у таблицы или как отбросить столбец. 
Расматривается встроенный метод `dropna` который позволяет быстро отбросить записи в которых отсутствуют данные.

Далее следует рассказать про маски, с помощью которых можно делать то, что делает метод `dropna` и многое другое. 
Любой запрос к таблице можно реализовать через маску.

У DataFrame есть метод [any](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.any.html), 
который позволяет из двумерной маски получить одномерную. Далее эту одномерную маску можно использовать в качестве числового индекса для фильтрации записей.

## Real data
Во втором ноутбуке происходит работа с реальными данными.

На моем занятии практически для всех стало проблемой открытие файла с данными. Это было связанно со следующими причимнами:
* В windows нет простого способа узнать полный путь к файлу
* В windows в качестве разделитея используется спец.символ `\`, который необходимо экранировать этим же спец.символом.
* Ребята могли копировать файл в другую папку и испортить его

Все эти проблемы можно избежать, если задать рабочую директорию своего ноутбука. Т.е. директорию из которой этот ноутбук выполняется. 
Если в рабочей директории будет лежать файл с данными, то при его отркытии можно не указывать полный путь, а указать только имя файла.

Я создал небольшой ноутбук [day_3_working_directory](https://github.com/rzaitov/earth_spbu/blob/main/day_3_working_directory.ipynb) в котором, 
показал как можно поменять рабочую директорию.

После того как проблемы с открытием файла решены, можно переходить к обработке данных. 
Видно, что в реальных данных колонок сильно больше, аж 28, но не все они нам нужны, поэтому имеет смысл отбросить колонки, 
которые нас не инересуют на занятии. Это можно сделать создав таблицу с нужными нам колонками с помощью `.loc`.

Далее предлагаю проанализировать записи в которых отсутствуют данные и отбросить их, сохранив данные табличной переменной `safe_data`.
Потом демонстрируем арифметику на колонках, т.е. что колонки можно складывать поэлементно. И показываем как создать новую колонку в таблице.

К этому моменту мы готовы строить TAS диаграмму! Строим маску, чтобы "выцепить" (отфильтровать) данные по базальту. 
Далее используем данные из столбца `SIO2` как X координату, а новую колонку `ALKALINE` используем как Y координату.

Как мне кажестся, код построения графика относительно короткий (см ниже).
```
fig = plt.figure()
ax = fig.add_subplot(1, 1, 1)
ax.plot(X, Y, '.')
```
К сожалению, у нас нет времени чтобы в подробностях объянить что там происходит, но можно показать картинку ниже, которая пояснит что означает `add_subplot(1, 1, 1)`.
Дело в том что библиотека `matplotlib`, которую мы используем позволяет на одной картинке построить сразу несколько графиков, 
поэтому на картинке `fig` создаются места, куда можно поместить новый график `ax`. В нашем случае у нас будет только один график.

![AEGXG](https://user-images.githubusercontent.com/2273285/164282172-828d7c78-e1c7-4a57-b5b3-166ac27ce1dd.png)

## Послесловие

Лекции которые мы подготовили основаны на следующих материалах:
* Курс на степике [Программирование на Python](https://stepik.org/course/67/promo)
* Курс на корсере [Introduction to Data Science in Python](coursera.org/learn/python-data-analysis)

В этом году мы не рассматривали вопрос построения графиков подробно. 
В прошлом году мы сделали эту попытку, но она скорее была неудачной, т.к. материала получилось слишком много. 
Ноутбук по гарфикам с прошлого года доступен по ссылке [matplotlib](https://github.com/rzaitov/earth_spbu/blob/main/matplotlib.ipynb)

Если хочется лучше понять как строить графики то можно воспользоваться курсом [Applied Plotting, Charting & Data Representation in Python](https://www.coursera.org/learn/python-plotting?specialization=data-science-python)


